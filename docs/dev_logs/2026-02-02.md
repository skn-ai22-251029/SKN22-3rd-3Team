# Development Log â€” 2026-02-02

## ê°œìš”
êµ­ê°€ë™ë¬¼ë³´í˜¸ì •ë³´ì‹œìŠ¤í…œ Tool ì‹¤êµ¬í˜„, ë„¤ì´ë° ì •ë¹„, Cat Card DTO í˜¸í™˜ ìˆ˜ì •, UI ë¦¬ë¼ì´íŠ¸, ìŠ¤íŠ¸ë¦¬ë° ê°œì„  ë“±ì„ ì§„í–‰.

---

## ì™„ë£Œëœ ì‘ì—…

### 1. êµ­ê°€ë™ë¬¼ë³´í˜¸ì •ë³´ì‹œìŠ¤í…œ Tool êµ¬í˜„

| í•­ëª© | ë‚´ìš© |
|---|---|
| ê¸°ì¡´ | `animal_registry.py` â€” Mock ë°ì´í„° ë°˜í™˜, `query_animal_registry(chip_number)` |
| ë³€ê²½ | `animal_protection.py` â€” ì‹¤ì œ API ì—°ë™, `search_abandoned_animals(sido, sigungu, breed, state)` |

- **`src/agents/tools/animal_protection.py`** (ì‹ ê·œ)
  - `abandonmentPublicService_v2` API í˜¸ì¶œ (`httpx` async)
  - ê³ ì–‘ì´ ì „ìš© (`upkind=422400` ê³ ì •)
  - ì‹œë„/ì‹œêµ°êµ¬ ì½”ë“œ â†’ `region_codes.py`ì—ì„œ ë³€í™˜
  - ìµœëŒ€ 5ê±´ ë°˜í™˜ (ë³´í˜¸ì†Œëª…, í’ˆì¢…ëª…, ë‚˜ì´, ì„±ë³„, ì¤‘ì„±í™”, ì‚¬ì§„, ì—°ë½ì²˜)
  - í™˜ê²½ë³€ìˆ˜: `OPENAPI_API_KEY` (ê³µê³µë°ì´í„°í¬í„¸ Decoding í‚¤)
- **`src/agents/tools/region_codes.py`** (ì‹ ê·œ)
  - 17ê°œ ì‹œë„ + ì „ì²´ ì‹œêµ°êµ¬ ì½”ë“œ ì •ì  ë”•ì…”ë„ˆë¦¬
  - ì‹¤ì œ API(`sido_v2`, `sigungu_v2`)ë¡œ í™•ë³´í•œ ë°ì´í„° ê¸°ë°˜
- **`src/agents/tools/animal_registry.py`** â€” ì‚­ì œ

### 2. ë„¤ì´ë° ë³€ê²½ ë°˜ì˜

| íŒŒì¼ | ë³€ê²½ |
|---|---|
| `src/agents/liaison.py` | `query_animal_registry` â†’ `search_abandoned_animals` import, í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ |
| `src/agents/graph.py` | ë™ì¼ import ë³€ê²½ |
| `docs/01_project/architecture_graph.md` | tool ì´ë¦„ Â· íŒŒì¼ê²½ë¡œ ë°˜ì˜ |
| `docs/01_project/overview.md` | tool ì´ë¦„ Â· íŒŒì¼ê²½ë¡œ Â· ë””ë ‰í† ë¦¬ êµ¬ì¡° ë°˜ì˜ |
| `docs/01_project/personas.md` | tool ì´ë¦„ Â· íŒŒì¼ê²½ë¡œ Â· ì†ŒìŠ¤ì½”ë“œ ë§í¬ ë°˜ì˜ |

### 3. Cat Card DTO í˜¸í™˜ ìˆ˜ì •

- **ë¬¸ì œ**: `CatCardRecommendation` DTOì— `description`ê³¼ `tags`ê°€ requiredì¸ë°, Matchmakerê°€ `state["recommendations"]`ì— ë„£ëŠ” raw MongoDB ë¬¸ì„œì—ëŠ” í•´ë‹¹ í•„ë“œ ì—†ìŒ â†’ Pydantic validation error â†’ `except: pass`ë¡œ ì¡°ìš©íˆ ì‹¤íŒ¨
- **ìˆ˜ì •**:
  - `src/agents/matchmaker.py` â€” `recommendations`ì— raw doc ë„£ì„ ë•Œ ëˆ„ë½ í•„ë“œ ë³´ì¶©:
    - `description` â† `summary[:100]`
    - `tags` â† `personality_traits[:4]` (ì•ì— `#` ì ‘ë‘ì–´)
  - `src/ui/app.py` â€” bare `except: pass` â†’ `except Exception as e` + ë¡œê·¸ ì¶œë ¥
- **ê²€ì¦**: Mock StoredBreedV3 doc â†’ `CatCardRecommendation(**doc)` ë³€í™˜ ì„±ê³µ í™•ì¸

### 4. UserProfile DTO â†’ dict ë³€í™˜

- **ë¬¸ì œ**: `app.py`ì—ì„œ `UserProfile` (Pydantic BaseModel) ê°ì²´ë¥¼ ê·¸ë˜í”„ stateì— ê·¸ëŒ€ë¡œ ì „ë‹¬ â†’ ì—ì´ì „íŠ¸ë“¤ì´ `profile.get('housing')` ê°™ì€ dict ë©”ì„œë“œë¡œ ì ‘ê·¼ â†’ `AttributeError: 'UserProfile' object has no attribute 'get'`
- **ìˆ˜ì •**: `src/ui/utils.py` â€” ê·¸ë˜í”„ ì…ë ¥ ì‹œ `user_profile.model_dump()`ë¡œ dict ë³€í™˜

### 5. UI ë¦¬ë¼ì´íŠ¸

- **`src/ui/app.py`** â€” ì „ë©´ ë¦¬ë¼ì´íŠ¸
  - Streamlit markdown ìœ„ì ¯ ìµœì†Œí™”, ì¸ë¼ì¸ HTML/CSSë¡œ ê°„ê²°í•˜ê²Œ
  - `header.py` import ì œê±°, í—¤ë” ì¸ë¼ì¸ í†µí•©
  - ë¡œë”© ìŠ¤í”Œë˜ì‹œ, ì‚¬ì´ë“œë°”, ì˜¨ë³´ë”© í¼, ì±„íŒ… í˜ì´ì§€ ì •ë¦¬
  - ë¦¬ì…‹ ì‹œ `thread_id` ì¬ìƒì„± ì¶”ê°€
- **`src/ui/style.css`** â€” ì „ë©´ ë¦¬ë¼ì´íŠ¸
  - Pretendard í°íŠ¸ ì „ì—­ ì ìš© (versioned CDN)
  - Streamlit chrome ìˆ¨ê¹€, ì±„íŒ… ë©”ì‹œì§€ Â· ì…ë ¥ì°½ ìµœì†Œ ìŠ¤íƒ€ì¼ë§
  - ê³¼ë„í•œ ê·¸ë¦¼ì/ë°°ê²½ ì œê±°

### 6. í”„ë¡œí•„ ì„œë UI

- í—¤ë”ì— í”„ë¡œí•„ ì •ë³´ ì§ì ‘ ë…¸ì¶œ â†’ `st.expander("ğŸ“‹ ì§‘ì‚¬ í”„ë¡œí•„")`ë¡œ ë³€ê²½
- í´ë¦­í•˜ë©´ ì„œë ì—´ë¦¼: í˜„ì¬ í”„ë¡œí•„ ê°’ì´ selectboxì— ë°˜ì˜ëœ ìƒíƒœë¡œ í‘œì‹œ
- ì„œë ì•ˆì—ì„œ ë°”ë¡œ ìˆ˜ì • í›„ "í”„ë¡œí•„ ì €ì¥" â†’ intro í˜ì´ì§€ ì´ë™ ì—†ì´ ì±„íŒ… ì¤‘ í”„ë¡œí•„ ë³€ê²½ ê°€ëŠ¥

### 7. ìŠ¤íŠ¸ë¦¬ë° ê°œì„  (`utils.py`)

- `astream` â†’ `astream_events v2`ë¡œ ì „í™˜ (LLM í† í° ë‹¨ìœ„ ìŠ¤íŠ¸ë¦¬ë°)
- ë…¸ë“œë³„ ìƒíƒœ ë©”ì‹œì§€ (`NODE_STATUS`) í‘œì‹œ: "ğŸ© ì§‘ì‚¬ê°€ ì§ˆë¬¸ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤..." ë“±
- `get_zipsa_response` (ë¹„ìŠ¤íŠ¸ë¦¬ë°) í•¨ìˆ˜ ì œê±°, ìŠ¤íŠ¸ë¦¬ë° ì „ìš©ìœ¼ë¡œ ë‹¨ì¼í™”
- ê¸°ì¡´ `app.astream` + ë³„ë„ `app.ainvoke` ì´ì¤‘í˜¸ì¶œ â†’ `astream_events`ì—ì„œ `on_chain_end`ë¡œ final state ì¶”ì¶œí•˜ëŠ” ë‹¨ì¼ í˜¸ì¶œë¡œ ë³€ê²½

### 8. uvloop í˜¸í™˜ ìˆ˜ì •

- **ë¬¸ì œ**: `nest_asyncio.apply()`ê°€ uvloop ì´ë²¤íŠ¸ ë£¨í”„ì™€ ë¹„í˜¸í™˜ â†’ `ValueError: Can't patch loop of type <class 'uvloop.Loop'>`
- **ìˆ˜ì •**: `nest_asyncio` ì œê±°, uvloop ê°ì§€ ì‹œ `asyncio.DefaultEventLoopPolicy()`ë¡œ ì „í™˜

---

## ë³€ê²½ íŒŒì¼ ì „ì²´ ëª©ë¡

| íŒŒì¼ | ìœ í˜• | ì„¤ëª… |
|---|---|---|
| `src/agents/tools/animal_protection.py` | **NEW** | ìœ ê¸°ë™ë¬¼ ì¡°íšŒ Tool (ì‹¤ì œ API) |
| `src/agents/tools/region_codes.py` | **NEW** | ì‹œë„/ì‹œêµ°êµ¬ ì½”ë“œ ë”•ì…”ë„ˆë¦¬ |
| `src/agents/tools/animal_registry.py` | **DELETE** | Mock tool ì œê±° |
| `src/agents/liaison.py` | MODIFY | import ë³€ê²½, í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ |
| `src/agents/graph.py` | MODIFY | import ë³€ê²½ |
| `src/agents/matchmaker.py` | MODIFY | recommendationsì— description/tags ë³´ì¶© |
| `src/ui/app.py` | **REWRITE** | UI ì „ë©´ ë¦¬ë¼ì´íŠ¸ + í”„ë¡œí•„ ì„œë + uvloop ëŒ€ì‘ |
| `src/ui/style.css` | **REWRITE** | ë¯¸ë‹ˆë©€ ìŠ¤íƒ€ì¼ ì „ë©´ ì¬ì‘ì„± |
| `src/ui/utils.py` | **REWRITE** | astream_events v2 ìŠ¤íŠ¸ë¦¬ë°, ë…¸ë“œ ìƒíƒœ í‘œì‹œ |
| `docs/01_project/architecture_graph.md` | MODIFY | ë„¤ì´ë° ë°˜ì˜ |
| `docs/01_project/overview.md` | MODIFY | ë„¤ì´ë° ë°˜ì˜ |
| `docs/01_project/personas.md` | MODIFY | ë„¤ì´ë° ë°˜ì˜ |

---

## í™˜ê²½ë³€ìˆ˜ ì¶”ê°€

| í‚¤ | ìš©ë„ | ë¹„ê³  |
|---|---|---|
| `OPENAPI_API_KEY` | ê³µê³µë°ì´í„°í¬í„¸ API (Decoding í‚¤) | `.env`ì— ì¶”ê°€ í•„ìš” |

---

## ë‚¨ì€ ì‘ì—… / ì²´í¬ë¦¬ìŠ¤íŠ¸

### í•„ìˆ˜

- [ ] **region_codes.py ì •í•©ì„± ì¬ê²€ì¦** â€” ê²½ìƒë‚¨ë„ `ì°½ì›ì‹œ`ê°€ APIì—ì„œ 3ê°œ ì½”ë“œ(5280000, 5320000, 5670000)ë¡œ ë°˜í™˜ë¨. í˜„ì¬ ì²« ë²ˆì§¸(5280000)ë§Œ ì €ì¥. í•„ìš” ì‹œ ì¤‘ë³µ í‚¤ ì²˜ë¦¬ ë¡œì§ ì¶”ê°€.
- [ ] **Liaison í†µí•© í…ŒìŠ¤íŠ¸** â€” ì‹¤ì œ ì±„íŒ… íë¦„ì—ì„œ "ê°•ë‚¨êµ¬ ê·¼ì²˜ ì…ì–‘ ê°€ëŠ¥í•œ ê³ ì–‘ì´ ë³´ì—¬ì¤˜" â†’ Liaison ë¼ìš°íŒ… â†’ `search_abandoned_animals` tool call â†’ ê²°ê³¼ í…ìŠ¤íŠ¸ ì‘ë‹µ í™•ì¸
- [ ] **Matchmaker Cat Card í†µí•© í…ŒìŠ¤íŠ¸** â€” í’ˆì¢… ì¶”ì²œ ìš”ì²­ â†’ ìš°ì¸¡ íŒ¨ë„ì— ì¹´ë“œ ì •ìƒ ë Œë”ë§ í™•ì¸ (description/tags í•„ë“œ í¬í•¨)
- [ ] **ìŠ¤íŠ¸ë¦¬ë° í† í° í•„í„°ë§ ê²€ì¦** â€” `astream_events`ì—ì„œ head_butlerì˜ routing ë‹¨ê³„ structured output í† í°ì´ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸. í˜„ì¬ëŠ” "contentê°€ ìˆëŠ” ëª¨ë“  í† í°"ì„ ë‚´ë³´ë‚´ë¯€ë¡œ, routing LLMì´ contentë¥¼ ìƒì„±í•˜ë©´ ë…¸ì´ì¦ˆ ë°œìƒ ê°€ëŠ¥.
- [ ] **í”„ë¡œí•„ ì €ì¥ í›„ ì—ì´ì „íŠ¸ ë°˜ì˜ í™•ì¸** â€” ì„œëì—ì„œ í”„ë¡œí•„ ìˆ˜ì • â†’ ë‹¤ìŒ ì§ˆë¬¸ì—ì„œ ë³€ê²½ëœ í”„ë¡œí•„ì´ ì—ì´ì „íŠ¸ contextì— ë°˜ì˜ë˜ëŠ”ì§€ í™•ì¸

### ê°œì„  ì‚¬í•­

- [ ] **ìœ ê¸°ë™ë¬¼ ê²°ê³¼ UI í¬ë§·** â€” í˜„ì¬ Liaisonì€ í…ìŠ¤íŠ¸ë¡œë§Œ ì‘ë‹µ. ë³´í˜¸ì†Œ ì‚¬ì§„, ì—°ë½ì²˜ ë“±ì„ ì¹´ë“œ í˜•íƒœë‚˜ êµ¬ì¡°í™”ëœ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œí•˜ë©´ ê°€ë…ì„± í–¥ìƒ.
- [ ] **region_codes.py ìë™ ê°±ì‹  ìŠ¤í¬ë¦½íŠ¸** â€” `scripts/fetch_region_codes.py` ì‘ì„±í•˜ì—¬ API í˜¸ì¶œ â†’ `region_codes.py` ìë™ ê°±ì‹ 
- [ ] **í’ˆì¢… ì½”ë“œ(`kindCd`) â†’ í’ˆì¢…ëª… ë§¤í•‘** â€” í˜„ì¬ `kindNm` í•„ë“œ ì‚¬ìš© ì¤‘ì´ë‚˜, íŠ¹ì • ì‘ë‹µì—ì„œ `kindNm` ëˆ„ë½ ì‹œ fallbackìœ¼ë¡œ ì½”ë“œ-í’ˆì¢… ë§¤í•‘ í…Œì´ë¸” í•„ìš” ì—¬ë¶€ í™•ì¸
- [ ] **breed íŒŒë¼ë¯¸í„° í•„í„°ë§ ê°œì„ ** â€” `search_abandoned_animals`ì—ì„œ `breed` í•„í„°ê°€ ë‹¨ìˆœ `in` ê²€ìƒ‰. í˜•íƒœì†Œ ë¶„ì„ì´ë‚˜ ìœ ì‚¬ì–´ ë§¤í•‘ ì ìš© ê²€í† .
- [ ] **ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”** â€” API í‚¤ ë¯¸ì„¤ì •, ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒ, rate limit ì‹œ ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€ í‘œì‹œ

### ê¸°ìˆ  ë¶€ì±„

- [ ] `src/ui/components/header.py` â€” ë” ì´ìƒ importë˜ì§€ ì•ŠìŒ. ì‚­ì œ ë˜ëŠ” ë³´ì¡´ ê²°ì •
- [ ] `src/ui/components/reasoning_stream.py` â€” ìŠ¤íŠ¸ë¦¬ë° ë¡œì§ì´ `utils.py`ë¡œ ì´ë™ë¨. ì‚¬ìš© ì—¬ë¶€ í™•ì¸ í›„ ì •ë¦¬
- [ ] `src/ui/components/debug_panel.py` â€” í˜„ì¬ UIì—ì„œ ë¯¸ì‚¬ìš©. ê°œë°œì ëª¨ë“œ ì¬ë„ì… ì‹œ í™œìš© ê°€ëŠ¥
- [ ] í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ ë¶€ì¬ â€” ì£¼ìš” í•¨ìˆ˜(`search_abandoned_animals`, DTO ë³€í™˜, í”„ë¡œí•„ ì§ë ¬í™”)ì— ëŒ€í•œ ìµœì†Œí•œì˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ê²€í† 
